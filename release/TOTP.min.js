var googleChartsURL='https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=200x200&chld=M|0&cht=qr&chl=otpauth://totp/';var defaultUser="user@example.com";class TOTP
{constructor(key,user)
{this.key=key;this.error_mess="";this.otp=0;this.countDown=0;this.log=!1;this.countDownCallback=null;this.updateCallback=null;if(typeof user===typeof undefined)user=defaultUser;this.user=user;this.update();var me=this;this.interval=setInterval(function(){var epoch=Math.round(new Date().getTime()/1000.0);me.countDown=30-(epoch%30);if(epoch%30==0)me.update();if(me.log)console.log('Update OTP in '+me.countDown+' seconds...');if(typeof me.countDownCallback==='function')
{me.countDownCallback(me)}else{console.log(me.countDownCallback)}},1000)}
setUpdateCallback(callback)
{this.updateCallback=callback}
setCountDownCallback(callback)
{this.countDownCallback=callback}
dec2hex(s)
{return(s<15.5?'0':'')+Math.round(s).toString(16)}
hex2dec(s)
{return parseInt(s,16)}
leftpad(str,len,pad)
{if(len+1>=str.length)
{str=Array(len+1-str.length).join(pad)+str}
return str}
base32tohex(base32)
{var base32chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";var bits="";var hex="";for(var i=0;i<base32.length;i++)
{var val=base32chars.indexOf(base32.charAt(i).toUpperCase());bits+=this.leftpad(val.toString(2),5,'0')}
for(var i=0;i+4<=bits.length;i+=4)
{var chunk=bits.substr(i,4);hex=hex+parseInt(chunk,2).toString(16)}
return hex}
update()
{var key=this.base32tohex(this.key);var epoch=Math.round(new Date().getTime()/1000.0);var time=this.leftpad(this.dec2hex(Math.floor(epoch/30)),16,'0');var shaObj=new jsSHA("SHA-1","HEX");shaObj.setHMACKey(key,"HEX");shaObj.update(time);var hmac=shaObj.getHMAC("HEX");var offset=0;if(hmac=='KEY MUST BE IN BYTE INCREMENTS'){this.error_mess=hmac;return!1}else{offset=this.hex2dec(hmac.substring(hmac.length-1))}
var otp=(this.hex2dec(hmac.substr(offset*2,8))&this.hex2dec('7fffffff'))+'';otp=(otp).substr(otp.length-6,6);this.otp=otp;if(this.log)console.log('New OTP: '+this.otp);if(typeof this.updateCallback==='function')
{this.updateCallback(this)}
return!0}
getOTP()
{return this.otp}
getCountDown()
{return this.countDown}
getQR()
{var url=googleChartsURL+this.user+'%3Fsecret%3D'+this.key;return url}
setKey(k)
{this.key=k;return!0}
setUser(u)
{this.user=u;return!0}
setLog(bool)
{this.log=bool;return!0}}
